<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8" />
<title>Comparar Transformadores</title>
</head>
<body>
  <h2>Carregar CSV e Comparar Transformadores</h2>
  
  <input type="file" id="csvFile" accept=".csv" /><br><br>
  
  ID do Transformador 1: <input type="text" id="id1" /><br><br>
  ID do Transformador 2: <input type="text" id="id2" /><br><br>
  
  <button onclick="processCSV()">Comparar</button>
  
  <p id="error" style="color:red;"></p>
  
  <div id="result"></div>
  
  <script>
  function processCSV() {
    const fileInput = document.getElementById('csvFile');
    const id1 = document.getElementById('id1').value.trim();
    const id2 = document.getElementById('id2').value.trim();
    const errorEl = document.getElementById('error');
    const resultEl = document.getElementById('result');
    
    errorEl.textContent = '';
    resultEl.innerHTML = '';
    
    if (!fileInput.files.length) {
      errorEl.textContent = 'Tens de carregar um ficheiro CSV.';
      return;
    }
    if (!id1 || !id2) {
      errorEl.textContent = 'Indica os dois IDs.';
      return;
    }
    
    const file = fileInput.files[0];
    const reader = new FileReader();
    
    reader.onload = function(e) {
      const text = e.target.result;
      const rows = text.split('\n').filter(r => r.trim() !== '');
      
      // Cabeçalho
      const headers = rows[0].split(',').map(h => h.trim());
      
      // Dados
      const data = rows.slice(1).map(row => {
        const vals = row.split(',');
        let obj = {};
        headers.forEach((h, i) => obj[h] = vals[i] ? vals[i].trim() : '');
        return obj;
      });
      
      // Encontrar linhas pelos IDs (supondo que a coluna é 'ID')
      const row1 = data.find(r => r['ID'] === id1);
      const row2 = data.find(r => r['ID'] === id2);
      
      if (!row1 || !row2) {
        errorEl.textContent = 'Um ou ambos os IDs não encontrados no CSV.';
        return;
      }
      
      // Parâmetros a comparar (tira todos menos ID)
      const params = headers.filter(h => h !== 'ID');
      
      let html = `<table border="1" cellpadding="5"><tr><th>Parâmetro</th><th>Transformador ${id1}</th><th>Transformador ${id2}</th><th>Diferença</th></tr>`;
      
      params.forEach(p => {
        const v1 = parseFloat(row1[p].replace(',', '.'));
        const v2 = parseFloat(row2[p].replace(',', '.'));
        
        let diff = 'N/A';
        if (!isNaN(v1) && !isNaN(v2)) {
          diff = (v1 - v2).toFixed(3);
        }
        
        html += `<tr><td>${p}</td><td>${row1[p]}</td><td>${row2[p]}</td><td>${diff}</td></tr>`;
      });
      
      html += '</table>';
      resultEl.innerHTML = html;
    };
    
    reader.readAsText(file);
  }
  </script>
</body>
</html>
