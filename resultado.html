

let dadosCSV = [];

document.getElementById('csvFile').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(event) {
    const texto = event.target.result;
    processaCSV(texto);
    document.getElementById('idInput').disabled = false;
    // corrige aqui para o botão que tens (o teu botão não tem id 'btnBuscar' no HTML)
    document.getElementById('resultado').textContent = 'CSV carregado. Insere o ID e procura.';
  };
  reader.readAsText(file);
});

function processaCSV(texto) {
  Papa.parse(texto, {
    header: true,
    skipEmptyLines: true,
    complete: function(resultado) {
      dadosCSV = resultado.data;
      console.log("CSV carregado!");
      console.log(dadosCSV);
    }
  });
}

function buscarDados() {
  const idInput = document.getElementById('idInput').value.trim();
  const resultadoDiv = document.getElementById('resultado');

  if (!idInput) {
    resultadoDiv.textContent = 'Por favor, insere um ID.';
    return;
  }

  // DEBUG: imprime todos os IDs do CSV
  console.log('IDs existentes:', dadosCSV.map(l => l.id_secagenscore));

  const encontrado = dadosCSV.find(linha => linha.id_secagenscore.trim() === idInput);

  if (encontrado) {
    resultadoDiv.innerHTML = `
      <h2>Resultados para ID: ${idInput}</h2>
      <p><strong>Potência:</strong> ${encontrado.potencia}</p>
      <p><strong>Tensão:</strong> ${encontrado.tensao}</p>
      <p><strong>Massat:</strong> ${encontrado.massat}</p>
      <p><strong>Massai:</strong> ${encontrado.massai}</p>
    `;
  } else {
    resultadoDiv.textContent = 'ID não encontrado.';
  }
}

