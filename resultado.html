<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <title>Consulta Transformador</title>
</head>
<body>

<h1>Consulta Transformador</h1>

<label for="idInput">Insere o ID do transformador (id_secagenscore):</label>
<input type="text" id="idInput" />
<button onclick="buscarDados()">Procurar</button>

<div id="resultado" style="margin-top:20px; white-space: pre-wrap;"></div>

<script>
  let dadosCSV = [];
  let dadosCarregados = false;

  fetch('parcialcore.csv')
    .then(res => {
      if (!res.ok) throw new Error('Erro ao carregar CSV: ' + res.status);
      return res.text();
    })
    .then(texto => {
      const linhas = texto.trim().split('\n');
      let separador = ',';
      if (linhas[0].includes(';')) separador = ';';

      const header = linhas[0].split(separador).map(h => h.trim());
      
      dadosCSV = linhas.slice(1).map(linha => {
        const colunas = linha.split(separador).map(c => c.trim());
        let obj = {};
        colunas.forEach((valor, i) => {
          obj[header[i]] = valor;
        });
        return obj;
      });

      dadosCarregados = true;
      document.getElementById('resultado').textContent = 'CSV carregado com sucesso. Pode procurar IDs.';
    })
    .catch(erro => {
      document.getElementById('resultado').textContent = erro.message;
    });

  function buscarDados() {
    const resultadoDiv = document.getElementById('resultado');

    if (!dadosCarregados) {
      resultadoDiv.textContent = 'Ainda estou a carregar os dados, espera um pouco...';
      return;
    }

    const idProcuradoTexto = document.getElementById('idInput').value.trim();
    if (!idProcuradoTexto) {
      resultadoDiv.textContent = 'Por favor, insere um ID válido.';
      return;
    }

    const idProcurado = Number(idProcuradoTexto);
    if (isNaN(idProcurado)) {
      resultadoDiv.textContent = 'O ID deve ser um número.';
      return;
    }

    const encontrado = dadosCSV.find(item => Number(item.id_secagenscore) === idProcurado);

    if (encontrado) {
      resultadoDiv.innerHTML = `
        <h2>Resultados para ID: ${idProcurado}</h2>
        <p><strong>Potência:</strong> ${encontrado.Potencia}</p>
        <p><strong>Tensão:</strong> ${encontrado.Tensao}</p>
        <p><strong>Massat:</strong> ${encontrado.Massat}</p>
        <p><strong>Massai:</strong> ${encontrado.Massai}</p>
      `;
    } else {
      resultadoDiv.textContent = 'ID não encontrado.';
    }
  }
</script>

</body>
</html>

