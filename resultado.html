<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8" />
<title>Consulta CSV via Upload</title>
</head>
<body>

<h1>Consulta Transformador</h1>

<label for="csvFile">Escolhe o ficheiro CSV:</label>
<input type="file" id="csvFile" accept=".csv" />
<br><br>
<label for="idInput">Insere o ID do transformador (id_secagenscore):</label>
<input type="text" id="idInput" placeholder="Insere o ID">
<button onclick="buscarDados()">Procurar</button>
<div id="resultado"></div>


<script>
  let dadosCSV = [];

  document.getElementById('csvFile').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(event) {
      const texto = event.target.result;
      processaCSV(texto);
      document.getElementById('idInput').disabled = false;
      document.getElementById('btnBuscar').disabled = false;
      document.getElementById('resultado').textContent = 'CSV carregado. Insere o ID e procura.';
    };
    reader.readAsText(file);
  });

function processaCSV(ficheiro) {
  const leitor = new FileReader();

  leitor.onload = function(e) {
    const conteudo = e.target.result;

    Papa.parse(conteudo, {
      header: true,
      skipEmptyLines: true,
      complete: function(resultado) {
        dadosCSV = resultado.data;
        console.log("CSV carregado!"); // <-- este
        console.log(dadosCSV);         // <-- e este
      }
    });
  };

  leitor.readAsText(ficheiro);
}

function buscarDados() {
  const idInput = document.getElementById('idInput').value.trim();
  const resultadoDiv = document.getElementById('resultado');

  if (!idInput) {
    resultadoDiv.textContent = 'Por favor, insere um ID.';
    return;
  }

  // DEBUG: imprime todos os IDs do CSV
  console.log('IDs existentes:', dadosCSV.map(l => l.id_secagenscore));

  const encontrado = dadosCSV.find(linha => linha.id_secagenscore.trim() === idInput);

  if (encontrado) {
    resultadoDiv.innerHTML = `
      <h2>Resultados para ID: ${idInput}</h2>
      <p><strong>Potência:</strong> ${encontrado.potencia}</p>
      <p><strong>Tensão:</strong> ${encontrado.tensao}</p>
      <p><strong>Massat:</strong> ${encontrado.massat}</p>
      <p><strong>Massai:</strong> ${encontrado.massai}</p>
    `;
  } else {
    resultadoDiv.textContent = 'ID não encontrado.';
  }
}


</script>

</body>
</html>

